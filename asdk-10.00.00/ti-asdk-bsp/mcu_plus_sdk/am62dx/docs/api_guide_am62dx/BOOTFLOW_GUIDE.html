<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM62D FreeRTOS SDK: Understanding the bootflow and bootloaders</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM62D FreeRTOS SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('BOOTFLOW_GUIDE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Understanding the bootflow and bootloaders </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md81">Introduction</a></li>
<li class="level1"><a href="#autotoc_md82">Additional References</a></li>
<li class="level1"><a href="#autotoc_md83">Preparing the application for boot</a></li>
<li class="level1"><a href="#autotoc_md84">Flashing the application for boot</a></li>
<li class="level1"><a href="#autotoc_md85">Booting the application</a><ul><li class="level2"><a href="#autotoc_md86">ROM Boot</a></li>
<li class="level2"><a href="#autotoc_md87">SBL Boot</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md88">Secondary Bootloaders</a><ul><li class="level2"><a href="#autotoc_md89">SBL NULL</a></li>
<li class="level2"><a href="#autotoc_md90">SBL UART</a></li>
<li class="level2"><a href="#autotoc_md91">Preparing the SBL for boot</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_bootflow"></a></p>
<h1><a class="anchor" id="autotoc_md81"></a>
Introduction</h1>
<p>Booting user defined applications on a SOC involves multiples steps as listed below,</p><ul>
<li>Firstly, there are multiple steps involved to convert a user application, created using a compiler+linker toolchain, into a binary format that is suitable to be booted by the SOC</li>
<li>Next, we need to flash this binary to the EVM flash</li>
<li>Finally, when the SOC is powered on, the previously flashed binary is executed.</li>
<li>After powering on the EVM, the bootflow takes place mainly in two steps<ul>
<li><b>ROM boot</b>, in which the ROM bootloader boots a secondary bootloader or an SBL</li>
<li><b>SBL boot</b> in which the secondary bootloader boots the application</li>
</ul>
</li>
<li>Note, that a system application itself can consist of multiple CPU specific application binaries that all collaborate together to realize the overall system goal.</li>
</ul>
<p>This section details these steps and gives an overview of the bootloaders to understand the process better.</p>
<h1><a class="anchor" id="autotoc_md82"></a>
Additional References</h1>
<p>See also these additional pages for more details and examples about the boot flow,</p>
<ul>
<li>To understand different secondary bootloader (SBL) examples see,<ul>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_NULL.html">SBL NULL</a></li>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_SD.html">SBL SD</a></li>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_UART_UNIFLASH_MULTISTAGE.html">SBL UART Uniflash</a></li>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_UART.html">SBL UART</a></li>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_EMMC_MULTISTAGE.html">SBL EMMC Multistage</a></li>
<li><a class="el" href="EXAMPLES_DRIVERS_SBL_OSPI_MULTISTAGE.html">SBL OSPI Multistage</a></li>
</ul>
</li>
<li>To understand the flashing steps, see <a class="el" href="TOOLS_FLASH.html">Flashing Tools</a></li>
<li>To understand the boot image creation tools, see <a class="el" href="TOOLS_BOOT.html">Booting Tools</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md83"></a>
Preparing the application for boot</h1>
<dl class="section note"><dt>Note</dt><dd>To see the exact sequence of steps in which applications and secondary bootloader (SBL) are converted from compiler generated .out files to boot images, see the makefile <code>makefile_ccs_bootimage_gen</code> that is included in every example and secondary bootloader (SBL) CCS project.</dd>
<dd>
If you are using makefile based build, then see the file named <code>makefile</code> in the example folder.</dd></dl>
<p>Shown below are the different steps that are done to convert the compiler+linker generated application <code>.out</code> into a format suitable for flashing and booting</p>
<ul>
<li>For each CPU, the compiler+linker toolchain is used to create the application .out "ELF" file which can be loaded and run via CCS</li>
<li>The below "post build" steps are then used to convert the application .out into a "flash" friendly format<ul>
<li>For each CPU, <code>out2rpc</code> is used to convert the ELF .out to a binary file containing only the loadable sections. This is called a RPRC file.</li>
<li><code>multiCoreGen</code> is then used to combine all the RPRC files per CPU into a single <code>.appimage</code> file which is a concatenation of the individual CPU specific RPRC files.</li>
</ul>
</li>
<li>This <code>.appimage</code> is then flash to the EVM</li>
</ul>
<p> <style>div.image img[src="bootflow_post_build_steps_no_xip.png"]{width:50%}</style> </p><div class="image">
<img src="bootflow_post_build_steps_no_xip.png" alt=""/>
<div class="caption">
Post build steps</div></div>
<h1><a class="anchor" id="autotoc_md84"></a>
Flashing the application for boot</h1>
<ul>
<li>Once the application image (<code>.appimage</code>) is created one needs to copy or flash these to a supported boot media so that the application can start executing once the SOC is powered ON</li>
<li>When flashing the application we also need to flash a bootloader or SBL image.</li>
<li>See <a class="el" href="TOOLS_FLASH.html">Flashing Tools</a> for detailed steps that are done to flash a user application </li>
</ul>
<h1><a class="anchor" id="autotoc_md85"></a>
Booting the application</h1>
<p>After a SBL and application image is flashed, shown below is the high level boot flow, after the SOC is powered on.</p>
<p> <style>div.image img[src="bootflow_main.png"]{width:40%}</style> </p><div class="image">
<img src="bootflow_main.png" alt=""/>
<div class="caption">
HIGH LEVEL BOOTFLOW</div></div>
<h2><a class="anchor" id="autotoc_md86"></a>
ROM Boot</h2>
<ul>
<li>As soon as the EVM is powered ON, the ROM bootloader or RBL starts running. The RBL is the primary bootloader.</li>
<li>Depending on which boot mode is selected on the EVM, the RBL will load the <b>secondary bootloader</b> or SBL from a boot media (OSPI flash, SD card or via UART).</li>
<li>ROM also loads TIFS binary to TIFS Cortex M4, board configuration data to the predefined locations.</li>
<li>Rest of the booting is done by the SBL.</li>
<li>The RBL expects the image it boots (SBL in our case) to always be signed. Refer <a class="el" href="TOOLS_BOOT.html">Booting Tools</a> for more information on signing scripts.</li>
</ul>
<h2><a class="anchor" id="autotoc_md87"></a>
SBL Boot</h2>
<ul>
<li>The SBL is essentially an example application of the bootloader library.</li>
<li>We call it a secondary bootloader because it is booted by the RBL, which is the primary bootloader.</li>
<li>An SBL typically does a bunch of SOC specific initializations and proceeds to the application loading.</li>
<li>In case of AM62DX EVM, the SBL loads the DM Firmware to DM R5F.</li>
<li>Depending on the type of SBL loaded, SBL looks for the <b>multicore appimage</b> (refer <a class="el" href="TOOLS_BOOT.html">Booting Tools</a> for more on multicore appimage) of the application binary at a specified location in a boot media.</li>
<li>If the appimage is found, the multicore appimage is parsed into multiple <b>RPRCs</b>. These are optimized binaries which are then loaded into individual CPUs.</li>
<li>Each RPRC image will have information regarding the core on which it is to be loaded, entry points and multiple sections of that application binary</li>
<li>The SBL uses this information to initialize each core which has a valid RPRC. It then loads the RPRC according to the sections specified, sets the entry points and releases the core from reset. Now the core will start running</li>
</ul>
<p> <video autoplay playinline muted controls width=50% style="display:block; margin: 0 auto;"> <source src="sbl_boot.mp4" type="video/mp4"> </video> <p style="text-align: center;"><strong>SBL BOOT</strong></p> </p>
<h1><a class="anchor" id="autotoc_md88"></a>
Secondary Bootloaders</h1>
<p>Depending on the boot media from which we load the application binary, we have multiple SBLs like <code>sbl_ospi</code>,<code>sbl_uart</code> etc. A bare minimum SBL called the <code>sbl_null</code> is also included which aids the users to load their applications via CCS.</p>
<h2><a class="anchor" id="autotoc_md89"></a>
SBL NULL</h2>
<ul>
<li>The <code>sbl_null</code> is a secondary bootloader which doesn't load any application binary, but just does the SOC initialization and puts all the cores in WFI (Wait For Interrupt) mode.</li>
<li>This is referred to as the SOC initialization binary, refer <a class="el" href="EVM_SETUP_PAGE.html#EVM_FLASH_SOC_INIT">Flash SOC Initialization Binary</a> for more on this.</li>
</ul>
<h2><a class="anchor" id="autotoc_md90"></a>
SBL UART</h2>
<ul>
<li>The <code>sbl_uart</code> is a secondary bootloader which receives the multicore appimage via UART, stores it in memory and then does the parsing, core initialization etc.</li>
<li>To boot an application using the <code>sbl_uart</code>, you can refer to <a class="el" href="TOOLS_BOOT.html#UART_BOOTLOADER_PYTHON_SCRIPT">UART Bootloader Python Script</a> subsection. Detailed steps on the usage is mentioned in the same subsection.</li>
</ul>
<h2><a class="anchor" id="autotoc_md91"></a>
Preparing the SBL for boot</h2>
<p>The SBL is like any other application, created using the same compiler and linker toolchain. However the steps to convert the application <code>.out</code> into a bootable image are different for SBL as listed below</p>
<ul>
<li>The SBL entry point needs to be different vs other applications. On AM62DX after power-ON ROM boots the SBL and sets the entry point of SBL to R5FSS0-0. This is done by specifying a different entry point <code>-e_vectors_sbl</code> in the linker command file for the SBL application.</li>
<li>Other special factors for SBL application are listed below<ul>
<li>The linker command file for SBL has to place vectors at address <code>0x43C00000</code> and this is the entry point for the SBL.</li>
<li>Nothing should be placed in ATCM or BTCM</li>
<li>Only the region <code>0x43C00000</code> to <code>0x43C3C800</code> should be used by SBL code, data, stack etc</li>
</ul>
</li>
<li>After building, the SBL application <code>.out</code> file is first converted to a binary format <code>.bin</code> using the GCC <code>objcopy</code> tool.<ul>
<li>This copies the loadable sections from the .out into a binary image stripping all symbol and section information.</li>
<li>If there are two loadable sections in the image which are not contiguous then <code>objcopy</code> fills the gaps with <code>0xFF</code>.</li>
<li>It is highly recommended to keep all loadable sections together within a SBL application.</li>
</ul>
</li>
<li>This <code>.bin</code> file is then signed using the <a class="el" href="TOOLS_BOOT.html#TOOLS_BOOT_SIGNING">Signing Scripts</a> to create the final <code>.tiimage</code> bootable image.<ul>
<li>A default key is used for this.</li>
<li>This is a ROM bootloader requirement and is needed even on a non-secure device.</li>
</ul>
</li>
<li>This <code>.tiimage</code> file can then be flashed or copied to a boot image using the <a class="el" href="TOOLS_FLASH.html">Flashing Tools</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
