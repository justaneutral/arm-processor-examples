<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM62D FreeRTOS SDK: Developing applications on  Device Manager/Wake-up R5 core</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM62D FreeRTOS SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DEVELOP_AND_DEBUG_DMR5.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Developing applications on Device Manager/Wake-up R5 core </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md149">Introduction</a></li>
<li class="level1"><a href="#autotoc_md150">Develop an application on Wake-up R5 core</a></li>
<li class="level1"><a href="#autotoc_md151">Build and load DMR5 examples</a></li>
<li class="level1"><a href="#autotoc_md152">Debugging an application on DMR5 core</a></li>
<li class="level1"><a href="#DISABLE_LPM">Disabling low power mode</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_develop_dmr5_applications"></a></p>
<dl class="section attention"><dt>Attention</dt><dd>It is recommended to use the TIFS version provided with the release for ensuring compatibility between TIFS and device manager. Using the TIFS from different MCU+SDK release is not recomended and may cause TIFS/ DM functionality to break.</dd></dl>
<h1><a class="anchor" id="autotoc_md149"></a>
Introduction</h1>
<dl class="section attention"><dt>Attention</dt><dd>DeepSleep low power mode (LPM) is not supported if the DM R5 is used for a general purpose application. This is because when the SoC goes to any LPM, the context of peripherals used by DM R5 will be lost. To use DM R5 for a general purpose application, disable LPM support. Refer <a class="el" href="DEVELOP_AND_DEBUG_DMR5.html#DISABLE_LPM">Disabling low power mode</a> to know how to disable LPM.</dd></dl>
<p>The wake-up R5 (or) device manager(DM) R5 core is responsible for running the DM firmware. The DM firmware is responsible for resource management and power management.</p>
<p>The DM firmware requires following components (as libraries) to be included in the application.</p><ul>
<li>"rm_pm_hal" consists of the calls for processing resource and power management.</li>
<li>"sciserver" receives the TI_SCI messages from other cores and processes it.</li>
<li>"sciclient_direct" calls the rm_pm_hal or sends the messages to TIFS based on the TI_SCI request.</li>
<li>"self_reset" contains the entry point of the DM firmware application. It resets the DM R5 and enables the TCMA.</li>
<li>"dm_stub" enables low power mode features.</li>
</ul>
<p>As the DM firmware requires multiple threads, it requires an RTOS. So any application on DM R5 should start the SCI server on a thread and actual application can be run on a different thread. Refer main.c of any r5fss0-0 example application to see how to implement this.</p>
<dl class="section attention"><dt>Attention</dt><dd><ul>
<li>As the wake-up R5 is the device manager, it needs to be started by the SBL. So it can not be loaded through CCS. It should be flashed and booted through SBL.</li>
<li>DM firmware needs to be multi-threading/rtos application as it creates multiple threads during initialization.</li>
<li>DM firmware as part of initialization via self_reset library swaps TCM configuration to have ATCM at 0x41010000 and BTCM at 0x0.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="autotoc_md150"></a>
Develop an application on Wake-up R5 core</h1>
<p>DM firmware required to be run on Wake-up R5 core to run the images which is being loaded to other cores during SBL Stage 2 Bootloader. This requires parsing and loading the images to respective cores during SBL Stage 2 Bootloader on R5 Core and then jumping to DM firmware on R5 Core. To avoid this delay, DM is being run as an additional thread in stage 2 bootloader and thus any core doesn't need to wait for parsing and loading of other cores and DM firmware to run.</p>
<p>So any applications to be run on DM-R5 core requires a thread to start the SCI server, stage 2 bootloader thread and an actual application to be run on DM-R5 core. Since stage 2 bootloader is being run as an additional thread, the application will get specific to bootmedia from which the application is being run. To avoid this and make the application support all boot medias, we can read the DEVSTAT register which gives details about the selected bootmedia and thus we can redirect the stage 2 bootloader thread to corresponding bootmedia specific APIs.</p>
<p>Stage 2 bootloader is needed only for OSPI or eMMC boot and not required for UART or SD bootmode. The above approach can be used to skip the creation of stage 2 bootloader thread for this two bootmedias and do only for OSPI, eMMC boot mode.</p>
<p>Refer main.c of ' Hello World ' r5fss0-0 example application to see the similar implementation.</p>
<ul>
<li>Read the DEVSTAT register using '<a class="el" href="group__DRV__SOC__MODULE.html#ga34631a13d4478b9ad49a5ce0ab4f9087" title="Get boot mode by reading devstat register.">SOC_getDevStat()</a>' to get the bootmode and make the ' void (*sbl_stage2_main) (void *) ' function pointer point to required bootmedia function.</li>
</ul>
<p> <style>div.image img[src="check_bootmode.png"]{width:50%}</style> </p><div class="image">
<img src="check_bootmode.png" alt=""/>
<div class="caption">
Read DEVSTAT and assign function pointer</div></div>
<h1><a class="anchor" id="autotoc_md151"></a>
Build and load DMR5 examples</h1>
<ul>
<li>Refer <a class="el" href="GETTING_STARTED_BUILD.html">Build a Hello World example</a> for building the application in debug mode, either by using CCS IDE or make utility.</li>
<li>After the application is build, use <a class="el" href="GETTING_STARTED_FLASH.html">Flash an example application</a> steps to flash and boot using SBL.</li>
</ul>
<h1><a class="anchor" id="autotoc_md152"></a>
Debugging an application on DMR5 core</h1>
<ul>
<li>Once the DM R5 is booted through SBL, symbols can be loaded through CCS for loading. Follow the below steps to debug any application developed for DM R5.<ul>
<li>Insert an infinite loop before the start of the test application.</li>
</ul>
</li>
</ul>
<p> <style>div.image img[src="infinite_loop.png"]{width:28%}</style> </p><div class="image">
<img src="infinite_loop.png" alt=""/>
<div class="caption">
Insert infinite loop</div></div>
<ul>
<li>Connect to WKUP-R5 core for debugging.</li>
</ul>
<p> <style>div.image img[src="ccs_connect.png"]{width:50%}</style> </p><div class="image">
<img src="ccs_connect.png" alt=""/>
<div class="caption">
Connect to DMR5 Core</div></div>
<ul>
<li>Load the symbols for the test application.</li>
</ul>
<p> <style>div.image img[src="ccs_load_symbols.png"]{width:60%}</style> </p><div class="image">
<img src="ccs_load_symbols.png" alt=""/>
<div class="caption">
Load Symbols for debug</div></div>
<ul>
<li>Navigate to the ".out" file generated by the test application.</li>
</ul>
<p> <style>div.image img[src="ccs_navigate.png"]{width:30%}</style> </p><div class="image">
<img src="ccs_navigate.png" alt=""/>
<div class="caption">
Navigate to the ELF</div></div>
<ul>
<li>In the CCS Debug Perspective's <b>Expressions</b> window, enter the <em>loop</em> variable and update its value to <em>0</em>.</li>
</ul>
<p> <style>div.image img[src="ccs_remove_infinite_loop.png"]{width:80%}</style> </p><div class="image">
<img src="ccs_remove_infinite_loop.png" alt=""/>
<div class="caption">
Update expression value</div></div>
<ul>
<li>Continue with the debugging process as usual.</li>
</ul>
<h1><a class="anchor" id="DISABLE_LPM"></a>
Disabling low power mode</h1>
<p>During low power mode DDR is kept in self refresh, because of this DM R5 cannot run from DDR. DM R5 run from the TCM memory. If Customer wants to use the TCM memory for customer application low power mode can be disabled and the memory will be usable for customer application. Follow the steps to free the TCM memory.</p>
<ul>
<li>Update the line '-CONFIG_LPM_DM=y' in source/drivers/device_manager/rm_pm_hal/BuildConfiguration<code>AM62DX</code>.mk to '-CONFIG_LPM_DM=n'.</li>
<li>Remove the line '-DCONFIG_LPM_DM \' from source/drivers/device_manager/sciclient_direct/makefile.<code>am62dx</code>.r5f.ti-arm-clang'.</li>
<li>Remove the line '-DCONFIG_LPM_DM \' from source/drivers/device_manager/sciserver/makefile.<code>am62dx</code>.r5f.ti-arm-clang.</li>
<li>Remove the following lines from the linker file of the application that you are building. <pre class="fragment">  GROUP{
        .dm_stub_text : {
            _privileged_code_begin = .;
            _text_secure_start = .;
            dm_stub*(.text)
        }  palign(8)

        .dm_stub_data : {
            _privileged_data_begin = .;
            dm_stub*(.data)
            _privileged_data_end = .;
        }  palign(8)

        .dm_stub_bss : {
            _start_bss = .;
            dm_stub*(.bss)
            _end_bss = .;
        }  palign(8)

        .dm_stub_rodata : {
            _start_rodata = .;
            dm_stub*(.rodata)
            _end_rodata = .;
        }  palign(8)

    .dm_stub_stack : {
            _start_stack = .;
            . += __DM_STUB_STACK_SIZE;
            _end_stack = .;
        }  palign(8)
    }  load = R5F_TCMB, run = R5F_TCMA
</pre></li>
<li>Rebuild the application. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
