<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM62D FreeRTOS SDK: DDR</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM62D FreeRTOS SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DRIVERS_DDR_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">DDR </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md427">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md428">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md429">Features not Supported</a></li>
<li class="level1"><a href="#autotoc_md430">Creating your own DDR config file</a><ul><li class="level2"><a href="#autotoc_md431">Step 1: Generate a DDR config file for your EVM</a></li>
<li class="level2"><a href="#autotoc_md432">Step 2: Add the generated DDR config file to your project</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md433">Creating your own LPDDR config file</a><ul><li class="level2"><a href="#autotoc_md434">Step 1: Generate a LPDDR config file for your EVM</a></li>
<li class="level2"><a href="#autotoc_md435">Step 2: Add the generated LPDDR config file to your project</a></li>
</ul>
</li>
<li class="level1"><a href="#ENABLE_DDR_INLINE_ECC">Enabling DDR inline ECC</a><ul><li class="level2"><a href="#ENABLE_DDR_INLINE_ECC_IN_SYSCONFIG">Step 1: Enable inline ECC in the SBL sysconfig</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md436">Important Usage Guidelines</a></li>
<li class="level1"><a href="#autotoc_md437">Usage Overview</a></li>
<li class="level1"><a href="#autotoc_md438">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md439">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_drivers_ddr"></a></p>
<dl class="section attention"><dt>Attention</dt><dd>Please note that this driver is supported only on DM R5(WKUP R5) as part SBL examples. It is not supported on MCU-R5.</dd></dl>
<p>The DDR driver provides API to configure the DDR module.</p>
<h1><a class="anchor" id="autotoc_md427"></a>
Features Supported</h1>
<ul>
<li>Ability to enable/disable DDR support in your application</li>
<li>Ability to specify the DDR config generated using the "DDR SUBSYSTEM REGISTER CONFIGURATION" tool</li>
<li>Ability to enable/disable inline ECC (1b and 2b) in the application</li>
<li>Add regions for enabling inline ECC</li>
</ul>
<h1><a class="anchor" id="autotoc_md428"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>Ability to specify the DDR config generated using the "DDR SUBSYSTEM REGISTER CONFIGURATION" tool</li>
<li>Enables DDR, EMIF module clock when DDR module is selected</li>
<li>Toggle inline ECC functionality</li>
<li>Add regions for which inline ECC needs to be enabled</li>
<li>Ability to set the SDRAM index based on the connected DDR size</li>
</ul>
<h1><a class="anchor" id="autotoc_md429"></a>
Features not Supported</h1>
<p>NA</p>
<h1><a class="anchor" id="autotoc_md430"></a>
Creating your own DDR config file</h1>
<h2><a class="anchor" id="autotoc_md431"></a>
Step 1: Generate a DDR config file for your EVM</h2>
<ul>
<li>Goto <a href="https://dev.ti.com/sysconfig">https://dev.ti.com/sysconfig</a></li>
<li>Select "Software Product" as "DDR SUBSYSTEM REGISTER CONFIGURATION"</li>
<li>Select "Device" of interest, AM62DX in this case.</li>
</ul>
<p> <style>div.image img[src="ddr_config_tool.png"]{width:60%}</style> </p><div class="image">
<img src="ddr_config_tool.png" alt=""/>
<div class="caption">
DDR SUBSYSTEM REGISTER CONFIGURATION Tool</div></div>
<ul>
<li>Configure the DDR parameters using the tool</li>
<li>Save the generated <code>board_ddrReginit.h</code> in your project workspace or work area</li>
</ul>
<p> <style>div.image img[src="ddr_config_tool_save.png"]{width:90%}</style> </p><div class="image">
<img src="ddr_config_tool_save.png" alt=""/>
<div class="caption">
Configure and save the generated file</div></div>
<h2><a class="anchor" id="autotoc_md432"></a>
Step 2: Add the generated DDR config file to your project</h2>
<ul>
<li>Open SysConfig (<a class="el" href="SYSCONFIG_INTRO_PAGE.html">Using SDK with SysConfig</a>) for your project</li>
<li>Add "DDR" as shown below</li>
</ul>
<p> <style>div.image img[src="ddr_sysconfig.png"]{width:60%}</style> </p><div class="image">
<img src="ddr_sysconfig.png" alt=""/>
<div class="caption">
Add DDR via SysConfig</div></div>
<ul>
<li>Specify the path to the generated <code>board_ddrReginit.h</code> file including the filename in the sysconfig text box as shown above<ul>
<li>Make sure to use forward slash "/" in the file path so that this will work with linux as well as windows build</li>
<li>Make sure that path to this is file set in your application include path, as needed.</li>
</ul>
</li>
<li>Save the sysconfig project and build your application</li>
</ul>
<h1><a class="anchor" id="autotoc_md433"></a>
Creating your own LPDDR config file</h1>
<h2><a class="anchor" id="autotoc_md434"></a>
Step 1: Generate a LPDDR config file for your EVM</h2>
<ul>
<li>Goto <a href="https://dev.ti.com/sysconfig">https://dev.ti.com/sysconfig</a></li>
<li>Select "Software Product" as "DDR SUBSYSTEM REGISTER CONFIGURATION"</li>
<li>Select "Device" of interest, AM62DX in this case.</li>
</ul>
<p> <style>div.image img[src="ddr_config_tool.png"]{width:60%}</style> </p><div class="image">
<img src="ddr_config_tool.png" alt=""/>
<div class="caption">
DDR SUBSYSTEM REGISTER CONFIGURATION Tool</div></div>
<ul>
<li>Configure the LPDDR parameters using the tool</li>
<li>Save the generated <code>board_ddrReginit.h</code> in your project workspace or work area. Rename the file as "board_lpddrReginit.h".</li>
</ul>
<p> <style>div.image img[src="lpddr_config_tool_save.png"]{width:90%}</style> </p><div class="image">
<img src="lpddr_config_tool_save.png" alt=""/>
<div class="caption">
Configure and save the generated file</div></div>
<h2><a class="anchor" id="autotoc_md435"></a>
Step 2: Add the generated LPDDR config file to your project</h2>
<ul>
<li>Open SysConfig (<a class="el" href="SYSCONFIG_INTRO_PAGE.html">Using SDK with SysConfig</a>) for your project</li>
<li>Add "DDR" as shown below</li>
</ul>
<p> <style>div.image img[src="lpddr_sysconfig.png"]{width:60%}</style> </p><div class="image">
<img src="lpddr_sysconfig.png" alt=""/>
<div class="caption">
Add DDR via SysConfig</div></div>
<ul>
<li>Specify the path to the generated <code>board_lpddrReginit.h</code> file including the filename in the sysconfig text box as shown above<ul>
<li>Make sure to use forward slash "/" in the file path so that this will work with linux as well as windows build</li>
<li>Make sure that path to this is file set in your application include path, as needed.</li>
</ul>
</li>
<li>Save the sysconfig project and build your application</li>
</ul>
<h1><a class="anchor" id="ENABLE_DDR_INLINE_ECC"></a>
Enabling DDR inline ECC</h1>
<ul>
<li>For SDRAM data integrity, the DDRSS bridge supports inline ECC on the data written to or read from the SDRAM. ECC is stored together with the data so that a dedicated SDRAM device for ECC is not required. The 8-bit single error correction double error detection (SECDED) ECC data is calculated over 64-bit data quanta.</li>
<li>For every 512-byte data block 64 bytes of ECC is stored inline.</li>
<li>Thus 1/9th of the total SDRAM space is used for ECC storage and the rest 8/9th is available for system use. From system point of view that 8/9th of the SDRAM data space are seen as consecutive byte addresses. DDRSS supports up to 3 ECC protected non-overlapping memory ranges.</li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>When inline ECC is enabled, the last 1/9th part of the DDR memory should not used. This rule applies irrespective of the size of the ECC regions.</dd></dl>
<h2><a class="anchor" id="ENABLE_DDR_INLINE_ECC_IN_SYSCONFIG"></a>
Step 1: Enable inline ECC in the SBL sysconfig</h2>
<ul>
<li>Open SysConfig file (<a class="el" href="SYSCONFIG_INTRO_PAGE.html">Using SDK with SysConfig</a>) of your SBL</li>
<li>Calculate the SDRAM index based on your connected DDR size and update the field<ul>
<li>Formula: SDRAM index = log2(connected DDR size) - 16</li>
</ul>
</li>
<li>Enable inline ECC and add regions for which inline ECC needs to be enabled as shown.</li>
</ul>
<p> <style>div.image img[src="inline_ecc_sysconfig.png"]{width:60%}</style> </p><div class="image">
<img src="inline_ecc_sysconfig.png" alt=""/>
<div class="caption">
Enable inline ECC via SysConfig</div></div>
<ul>
<li>Things to take care when adding ECC regions,<ul>
<li>The address (ECC start and end) has to be specified as an offset from the DDR region start</li>
<li>The ECC region is inclusive of the start and end address.</li>
<li>The ECC region start address and the size should be aligned to 0x10000 bytes</li>
<li>The ECC region size has to be in the powers of two and greater than 0x10000 bytes</li>
<li>ECC region size = ECC region end address - ECC region start address + 1</li>
<li>When ECC is enabled, BIST engine primes only the 8/9th portion of the given size. So the actual ECC end address will be lesser than the given ECC address.</li>
<li>For the given ECC region, the actual end address will be calculated and displayed in the sysconfig</li>
<li>When ECC is enabled, last 1/9th of the total SDRAM space is used for ECC storage and the rest 8/9th is available for system use.</li>
<li>So 8/9th of the given ECC region should not fall under the last 1/9th part of the DDR memory.</li>
</ul>
</li>
<li>Sysconfig files will get generated only if all the above conditions are met, otherwise it will throw an error. <dl class="section note"><dt>Note</dt><dd>If you are using older release and migrating to 09_02 SDK, please make sure the above conditions are met in the added ECC regions.</dd></dl>
</li>
<li>Save the sysconfig project</li>
<li>In the SBL, before using the DDR memory check if DDR init is done using the DDR_isInitDone function. <div class="fragment"><div class="line">while(!DDR_isInitDone())</div>
<div class="line">{</div>
<div class="line">    ClockP_usleep(100);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Build the SBL</li>
</ul>
<h1><a class="anchor" id="autotoc_md436"></a>
Important Usage Guidelines</h1>
<ul>
<li>Ideally DDR should be enabled in the bootloader application and the SDK bootloader by default enables DDR by default.</li>
</ul>
<h1><a class="anchor" id="autotoc_md437"></a>
Usage Overview</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ddr_8h.html">drivers/ddr.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* DDR register config .h file as generated from DDR SUBSYSTEM REGISTER CONFIGURATION tool</span></div>
<div class="line"><span class="comment"> * Make sure path to this file is specified in your application project/makefile include path</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &quot;drivers/ddr/v0/soc/am64x_am243x/board_ddrReginit.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structDDR__Params.html">DDR_Params</a> gDdrParams =</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* below values are set using the globals defined in drivers/ddr/v0/soc/am64x_am243x/board_ddrReginit.h */</span></div>
<div class="line">    .<a class="code" href="structDDR__Params.html#ae9d48cf2a568021b6c596d69f07a0817">clk1Freq</a>              = DDRSS_PLL_FREQUENCY_1,</div>
<div class="line">    .clk2Freq              = DDRSS_PLL_FREQUENCY_2,</div>
<div class="line">    .ddrssCtlReg           = DDRSS_ctlReg,</div>
<div class="line">    .ddrssPhyIndepReg      = DDRSS_phyIndepReg,</div>
<div class="line">    .ddrssPhyReg           = DDRSS_phyReg,</div>
<div class="line">    .ddrssCtlRegNum        = DDRSS_ctlRegNum,</div>
<div class="line">    .ddrssPhyIndepRegNum   = DDRSS_phyIndepRegNum,</div>
<div class="line">    .ddrssPhyRegNum        = DDRSS_phyRegNum,</div>
<div class="line">    .ddrssCtlRegCount      = DDRSS_CTL_REG_INIT_COUNT,</div>
<div class="line">    .ddrssPhyIndepRegCount = DDRSS_PHY_INDEP_REG_INIT_COUNT,</div>
<div class="line">    .ddrssPhyRegCount      = DDRSS_PHY_REG_INIT_COUNT,</div>
<div class="line">    .fshcount              = DDRSS_PLL_FHS_CNT,</div>
<div class="line">    .enableEccFlag = 0,</div>
<div class="line">    .eccRegion = NULL,</div>
<div class="line">};</div>
</div><!-- fragment --><p> Initialize DDR </p><div class="fragment"><div class="line">    <a class="code" href="group__DRV__DDR__MODULE.html#gab0fc0ed95040409681fb38d621cc03ca">DDR_init</a>(&amp;gDdrParams);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md438"></a>
Example Usage</h1>
<p>NA</p>
<h1><a class="anchor" id="autotoc_md439"></a>
API</h1>
<p><a class="el" href="group__DRV__DDR__MODULE.html">APIs for DDR</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__DRV__DDR__MODULE_html_gab0fc0ed95040409681fb38d621cc03ca"><div class="ttname"><a href="group__DRV__DDR__MODULE.html#gab0fc0ed95040409681fb38d621cc03ca">DDR_init</a></div><div class="ttdeci">int32_t DDR_init(DDR_Params *prms)</div><div class="ttdoc">DDR4 Initialization function.</div></div>
<div class="ttc" id="astructDDR__Params_html_ae9d48cf2a568021b6c596d69f07a0817"><div class="ttname"><a href="structDDR__Params.html#ae9d48cf2a568021b6c596d69f07a0817">DDR_Params::clk1Freq</a></div><div class="ttdeci">uint64_t clk1Freq</div><div class="ttdef"><b>Definition:</b> ddr/v0/ddr.h:110</div></div>
<div class="ttc" id="astructDDR__Params_html"><div class="ttname"><a href="structDDR__Params.html">DDR_Params</a></div><div class="ttdoc">DDR config structure.</div><div class="ttdef"><b>Definition:</b> ddr/v0/ddr.h:109</div></div>
<div class="ttc" id="addr_8h_html"><div class="ttname"><a href="ddr_8h.html">ddr.h</a></div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
